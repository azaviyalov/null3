<div class="user-dialog">
  <h2 mat-dialog-title>
    @if (data.mode === 'create') {
      Create New User
    } @else {
      Edit User
    }
  </h2>

  <mat-dialog-content>
    <form [formGroup]="form" class="user-form">
      @if (error()) {
        <div class="error-message">
          {{ error() }}
        </div>
      }

      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Name</mat-label>
        <input matInput formControlName="name" autocomplete="name" />
        @if (form.get('name')?.hasError('required') && form.get('name')?.touched) {
          <mat-error>Name is required</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Email</mat-label>
        <input matInput type="email" formControlName="email" autocomplete="email" />
        @if (form.get('email')?.hasError('required') && form.get('email')?.touched) {
          <mat-error>Email is required</mat-error>
        }
        @if (form.get('email')?.hasError('email') && form.get('email')?.touched) {
          <mat-error>Please enter a valid email address</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Password</mat-label>
        <input matInput type="password" formControlName="password" autocomplete="new-password" />
        @if (form.get('password')?.hasError('required') && form.get('password')?.touched) {
          <mat-error>Password is required</mat-error>
        }
        @if (form.get('password')?.hasError('minlength') && form.get('password')?.touched) {
          <mat-error>Password must be at least 6 characters long</mat-error>
        }
      </mat-form-field>

      @if (data.mode === 'edit') {
        <div class="edit-note">
          <small>Leave password empty to keep the current password unchanged.</small>
        </div>
      }
    </form>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="cancel()">Cancel</button>
    <button
      mat-raised-button
      color="primary"
      (click)="save()"
      [disabled]="form.invalid || isSubmitting()"
    >
      @if (isSubmitting()) {
        Saving...
      } @else if (data.mode === 'create') {
        Create User
      } @else {
        Update User
      }
    </button>
  </mat-dialog-actions>
</div>